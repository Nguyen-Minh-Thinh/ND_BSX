<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhóm Anh Thịnh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-camera-fill me-2"></i>Smart LPR System
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="#">Trang chủ</a></li>
                    <li class="nav-item"><a class="nav-link" href="#analytics">Thống kê</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="hero-section py-5 mb-4">
        <div class="container text-center">
            <h1 class="display-4 mb-3">Nhận diện biển số xe</h1>
            <p class="lead">Hệ thống AI hỗ trợ nhận diện biển số xe</p>
        </div>
    </div>

    <div class="container py-4">
        <div class="row">
            <div class="col">
                <div class="card shadow-lg recognition-card mb-4">
                    <div class="card-body p-4">
                        <h3 class="card-title mb-4">Quét biển số xe</h3>
                        <div class="btn-group d-flex justify-content-center mb-4" role="group">
                            <input type="radio" class="btn-check" name="vehicleType" id="motorbike" autocomplete="off" checked>
                            <label class="btn btn-outline-primary" for="motorbike">Xe máy</label>
                            <input type="radio" class="btn-check" name="vehicleType" id="car" autocomplete="off">
                            <label class="btn btn-outline-primary" for="car">Ô tô</label>
                        </div>
                        <div class="upload-zone mb-4" id="dropZone">
                            <div class="text-center p-4 border rounded-3 position-relative">
                                <img src="https://images.unsplash.com/photo-1590856029826-c7a73142bbf1" class="preview-image d-none mb-3" alt="Preview">
                                <video controls class="preview-video d-none mb-3" width="100%"></video>
                                <div class="upload-content">
                                    <i class="bi bi-cloud-upload display-4"></i>
                                    <p class="mb-2">Kéo và thả ảnh hoặc click để tải lên</p>
                                    <p class="text-muted small mb-3">Hỗ trợ định dạng: .jpg, .jpeg, .png</p>
                                    <label class="btn btn-primary mb-0" for="fileInput">Duyệt tập tin</label>
                                    <input type="file" id="fileInput" class="d-none" accept=".jpg,.jpeg,.png">
                                </div>
                            </div>
                        </div>
                        <div class="recognition-result mb-4 d-none">
                            <div class="card border-success">
                                <div class="card-body">
                                    <h5 class="card-title">Kết quả nhận diện</h5>
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <p class="mb-2"><strong>Biển số xe:</strong></p>
                                            <h3 class="plate-number">ABC 123</h3>
                                        </div>
                                        <div class="col-md-4">
                                            <p class="mb-2"><strong>Tỉ lệ xác thực:</strong></p>
                                            <div class="progress">
                                                <div class="progress-bar" role="progressbar" style="width: 95%" aria-valuenow="95" aria-valuemin="0" aria-valuemax="100">95%</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <p class="mb-2"><strong>Loại xe:</strong></p>
                                            <p class="vehicle-type mb-0">Car</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center">
                            <button type="button" class="btn btn-primary btn-lg" id="recognizeBtn" disabled>Nhận dạng</button>
                            <button type="button" class="btn btn-outline-secondary btn-lg ms-2" id="resetBtn">Xóa</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <section id="analytics" class="mb-5 d-none">
            <h3 class="mb-4">Tổng quan thống kê</h3>
            <div class="row g-4">
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <h5 class="card-title">Tổng số lần quét</h5>
                            <p class="display-6">1,234</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <h5 class="card-title">Tỷ lệ thành công</h5>
                            <p class="display-6">98.5%</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <h5 class="card-title">Ô tô</h5>
                            <p class="display-6">856</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning text-white">
                        <div class="card-body">
                            <h5 class="card-title">Xe máy</h5>
                            <p class="display-6">378</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Smart LPR System</h5>
                    <p>Hệ thống nhận diện biển số tiên tiến sử dụng AI</p>
                </div>
                <div class="col-md-3">
                    <h5>Liên kết nhanh</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white">Trang chủ</a></li>
                        <li><a href="#history" class="text-white">Lịch sử</a></li>
                        <li><a href="#analytics" class="text-white">Thống kê</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Liên hệ</h5>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-envelope me-2"></i>support@lpr.com</li>
                        <li><i class="bi bi-telephone me-2"></i>1-800-LPR-SCAN</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.getElementById("fileInput");
        const recognizeBtn = document.getElementById("recognizeBtn");
        const resetBtn = document.getElementById("resetBtn");
        const dropZone = document.getElementById("dropZone");
        const resultSection = document.querySelector(".recognition-result");
        const plateNumber = document.querySelector(".plate-number");
        const confidenceBar = document.querySelector(".progress-bar");
        const vehicleTypeText = document.querySelector(".vehicle-type");

        let selectedFile = null;
        let isResultDisplayed = false;

        dropZone.addEventListener("dragover", (e) => {
            e.preventDefault();
            if (!isResultDisplayed) {
                dropZone.classList.add("border-primary");
            }
        });

        dropZone.addEventListener("dragleave", () => {
            dropZone.classList.remove("border-primary");
        });

        dropZone.addEventListener("drop", (e) => {
            e.preventDefault();
            dropZone.classList.remove("border-primary");
            if (!isResultDisplayed) {
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    handleFileChange(files[0]);
                }
            }
        });

        fileInput.addEventListener("change", (e) => {
            if (!isResultDisplayed) {
                handleFileChange(e.target.files[0]);
            }
        });

        function handleFileChange(file) {
            if (!file) return;
            selectedFile = file;
            const fileType = file.type;

            const videoPreview = document.querySelector(".preview-video");
            const uploadContent = document.querySelector(".upload-content");

            const existingPreviewImage = dropZone.querySelector(".preview-image:not(.d-none)");
            if (existingPreviewImage) {
                existingPreviewImage.remove();
            }
            videoPreview.classList.add("d-none");
            videoPreview.src = "";

            if (fileType.startsWith("image/")) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const imagePreview = document.createElement("img");
                    imagePreview.src = e.target.result;
                    imagePreview.className = "preview-image mb-3";
                    imagePreview.style.maxWidth = "100%";
                    dropZone.querySelector(".text-center").prepend(imagePreview);
                };
                reader.readAsDataURL(file);
            }

            uploadContent.classList.add("d-none");
            recognizeBtn.disabled = false;
            console.log("File đã chọn, sẵn sàng nhận dạng");
        }

        recognizeBtn.addEventListener("click", async (e) => {
            e.preventDefault();
            e.stopPropagation();
            if (!selectedFile || isResultDisplayed) {
                console.log("Không có file hoặc kết quả đang hiển thị");
                return;
            }

            const formData = new FormData();
            formData.append("image", selectedFile);
            const vehicleType = document.querySelector("input[name='vehicleType']:checked")?.id || "";
            formData.append("vehicleType", vehicleType);

            try {
                recognizeBtn.innerText = "Đang xử lý...";
                recognizeBtn.disabled = true;
                console.log("Gửi yêu cầu API...");

                const response = await fetch("http://localhost:8080/api/recognize", {
                    method: "POST",
                    body: formData,
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `Lỗi HTTP: ${response.status}`);
                }

                const result = await response.json();
                console.log("Kết quả API:", result);

                plateNumber.textContent = result.plate || "Không xác định";
                confidenceBar.style.width = `${result.confidence}%`;
                confidenceBar.setAttribute("aria-valuenow", result.confidence);
                confidenceBar.textContent = `${result.confidence}%`;
                vehicleTypeText.textContent = result.vehicleType || "Không xác định";

                resultSection.classList.remove("d-none");
                isResultDisplayed = true;
                console.log("Hiển thị kết quả");
            } catch (error) {
                console.error("Lỗi nhận diện:", error);
                alert(`Lỗi nhận diện: ${error.message}`);
                resultSection.classList.add("d-none");
                isResultDisplayed = false;
            }
        });

        resetBtn.addEventListener("click", (e) => {
            e.preventDefault();
            fileInput.value = "";
            const existingPreviewImage = dropZone.querySelector(".preview-image:not(.d-none)");
            if (existingPreviewImage) {
                existingPreviewImage.remove();
            }
            const videoPreview = document.querySelector(".preview-video");
            if (videoPreview) {
                videoPreview.pause();
                videoPreview.src = "";
                videoPreview.classList.add("d-none");
            }

            resultSection.classList.add("d-none");
            isResultDisplayed = false;
            document.querySelector(".upload-content").classList.remove("d-none");
            recognizeBtn.disabled = true;
            recognizeBtn.innerText = "Nhận dạng";
            selectedFile = null;
            console.log("Đã xóa, sẵn sàng cho nhận dạng mới");
        });
    });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>